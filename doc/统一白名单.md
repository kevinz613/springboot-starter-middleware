# 服务治理 - 统一白名单

> 需求背景：<br>
> <p>在互联网这种多数面向C端的用户场景下，我们开发的产品功能交互之后，通常并不会直接发布上线，尤其是在原有功能已经沉淀了大量的用户时，不断的迭代开发新增需求下更不会贸然发布上线。</p>
> <p>虽然在测试环境下，预发环境都有了相应的功能的验证，但是在真实的用户场景下，还是可能存在其他的隐患问题。所以，<em style="color: salmon">为了更好的控制系统风险，通常需要开发人员在代码的接口层提供白名单控制，上线初期先提供可配置的白名单用户进行访问验证，控制整体的交互风险。</em></p>
> <p>白名单确实可以解决接口功能或者服务入口访问范围的风险，但是存在技术方案实现的问题：<em style="color: salmon">如果开发人员在所有接口上都加上这样的白名单功能，那么会非常的耗时耗力，当功能不需要时，还需要再将代码删除。在这个大量添加和删除代码的过程中，可能还会造成误删等操作风险，所以我们可以设计开发一个通用的白名单服务，减少开发在这方面的重复。</em></p>

## 方案设计
> 白名单属于业务系统开发过程中可重复使用的通用功能，所以我们可以把这样的工具型功能提炼出来作为一个通用组件，哪个系统需要这个功能，只需引入使用即可。

设计方案如图所示:

<img src="https://raw.githubusercontent.com/zhuangfuzhi/notes-images/main/imgs/image-20231022191329172.png">

- 使用自定义注解、切面技术和SpringBoot对配置的处理方式，开发白名单中间件
- 在中间件中通过提取指定字段的入参与配置文件白名单用户列表做对比确认是否允许访问
- 最后把开发好的中间件引入到需要使用到白名单服务的系统中，在SpringBoot启动时进行加载

## 编码实现
